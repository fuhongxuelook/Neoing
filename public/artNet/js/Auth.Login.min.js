require(["jquery","bus","common"],function(i,e,t){function n(i){var e=new RegExp("(^|&)"+i+"=([^&]*)(&|$)"),t=window.location.search.substr(1).match(e);return null!=t?unescape(t[2]):null}function s(e){f=i(e).val(),u=common.mobileReg.test(f)?2:common.emailReg.test(f)?1:0,0==u?i(e).siblings("p").show():2==u?(i(e).siblings("p").hide(),i(e).siblings(".tip").hide(),i(e).parent().siblings(".phonecode").show()):1==u&&(i(e).siblings("p").hide(),i(e).siblings(".tip").hide(),i(e).parent().siblings(".phonecode").hide())}function a(e){function t(){var t={};t.module="Auth.Reg",t.action="UserReg",t.account=f,t.verifyCode=o,t.pwd=a,t.regtype=u,null!=n("agentcode")&&(t.agentcode="121686167"),i.ajax({url:"/ajaxbase/index",data:t}).done(function(t){if(i(e).attr("disabled",!1),t.Success&&!t.HasError)common.LOGIN_CALLBACK?common.LOGIN_CALLBACK()&&(location.href=location.href):loginpass();else if(t.HasError&&t.ErrorMsg)switch(t.ErrorData){case"pwd":i(e).siblings(".password").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;case"account":case"regtype":i(e).siblings(".account").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;case"verifycode":2==u?i(e).siblings(".phonecode").find(".tip").text(t.ErrorMsg).css("display","inline-table"):1==u?i(e).siblings(".imgcode").find(".tip").text(t.ErrorMsg).css("display","inline-table"):alert(t.ErrorMsg);break;default:alert(t.ErrorMsg)}})}if(i(e).attr("disabled",!0),i(".tip").hide(),s(i(e).siblings(".account").find("input")[0]),0==u)return i(e).siblings(".account").find(".tip").text("您输入的不是一个手机号或邮箱").css("display","inline-table"),void i(e).attr("disabled",!1);var a=i(e).siblings(".password").find("input").val();if(a.length<6||a.length>16)return i(e).siblings(".password").find(".tip").text("密码为6-16位").css("display","inline-table"),void i(e).attr("disabled",!1);var o=i(e).siblings(".imgcode").find("input").val();if(""==o)return i(e).siblings(".imgcode").find(".tip").text("请输入图形验证码").css("display","inline-table"),void i(e).attr("disabled",!1);if(2==u){if(""==(o=i(e).siblings(".phonecode").find("input").val()))return i(e).siblings(".phonecode").find(".tip").text("请输入短信验证码").css("display","inline-table"),void i(e).attr("disabled",!1);t()}if(1==u){var r={};r.module="Common.VerifyCode",r.action="CheckImgCode",r.captchacode=o,i.ajax({data:r}).done(function(n){i(e).attr("disabled",!1),n.Success&&!n.HasError?t():i(e).siblings(".imgcode").find(".tip").text(n.ErrorMsg).css("display","inline-table")})}}function o(){i(".page_login_dialog>section").hide(),i(".login_dialog").show()}function r(){i(".page_login_dialog>section").hide(),i(".register_phone_dialog").show()}function c(){i(".page_login_dialog>section").hide(),i(".forgotpw").show()}function l(){i(".forgotpw_phone .imgcode input").val(i(".forgotpw .imgcode input").val()),i(".page_login_dialog>section").hide(),i(".forgotpw_phone").show()}function d(e,t){if(2==e)i(".forgotpw_success .info").text("密码重置成功，请重新登录");else{if(1!=e)return;i(".forgotpw_success .info").text("重置密码的链接已经发送到您的邮箱："),i(".forgotpw_success .emailvalue").text(t)}i(".page_login_dialog>section").hide(),i(".forgotpw_success").show()}if(null!=n("agentcode")&&(i("#weibo").attr("href","/Auth/WeiboLogin?agentcode=121686167"),i("#weixin").attr("href","/Auth/WeixinLogin?agentcode=121686167")),window.loginpass=function(){if(""!=location.search&&void 0!==location.search.split("returnurl=")[1])return void(location.href=decodeURIComponent(location.search.split("returnurl=")[1].split("&")[0]));-1!=location.href.indexOf("/Login")||-1!=location.href.indexOf("/login")?common.returnrefererr("/"):common.pass("/")},i(".logincshtml_background").length>0){i(".closelogin").click(function(){common.returnrefererr("/")}),i(".page_login").show();var p=['url("https://cdn.ywart.com/material/mainsite/login/login-back-1.jpg")','url("https://cdn.ywart.com/material/mainsite/login/login-back-2.jpg")','url("https://cdn.ywart.com/material/mainsite/login/login-back-3.jpg")'],g=p.length*Math.random()>>0;i(".logincshtml_background").css("background-image",p[g])}else i(".closelogin").click(function(){i(".page_login").hide()});i(".inputdiv input").on("focus",function(){i(this).siblings("p").animate({top:"-22px","font-size":"12px"}).css("color","#3c948b"),i(this).siblings(".line").animate({width:"300px"})});var u=0,f="";i(".account input").on("blur",function(){s(this)}),i(".forgetpwbtn").click(function(){c()}),i(".login_dialog .hasanother span").click(function(){r()}),i(".login_dialog .submit").on("click",function(){var e=this;if(i(".tip").hide(),i(e).attr("disabled",!0),s(i(e).siblings(".account").find("input")[0]),0==u)return i(e).siblings(".account").find(".tip").text("您输入的不是一个手机号或邮箱").css("display","inline-table"),void i(e).attr("disabled",!1);var t=i(e).siblings(".password").find("input").val();if(""==t)return i(e).siblings(".password").find(".tip").text("登录密码不能为空").css("display","inline-table"),void i(e).attr("disabled",!1);var n={};n.module="Auth.Login",n.action="UserLogin",n.account=f,n.pwd=t,n.type=u,i.ajax({url:"/ajaxbase/index",data:n}).done(function(t){if(i(e).attr("disabled",!1),t.Success&&!t.HasError)common.LOGIN_CALLBACK?common.LOGIN_CALLBACK()&&(location.href=location.href):/login/.test(location.href)?(i(".page_login_dialog").css({background:"none","text-align":"center"}).html('<p class="welcomeback" style="font-size:64px;display:none;color:#fff">欢迎回来</p>'),i(".welcomeback").fadeIn(600),setTimeout(function(){loginpass()},1600)):loginpass();else if(t.HasError&&t.ErrorMsg)switch(t.ErrorData){case"pwd":i(e).siblings(".password").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;case"account":case"type":i(e).siblings(".account").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;default:alert(t.ErrorMsg)}})}),i(".register_phone_dialog .hasanother span").click(function(){o()}),i(".register_phone_dialog .submit").on("click",function(){a(this)}),i(".loginbtn").click(function(){o()}),i(".forgotpw .submit").on("click",function(){var e=this;if(i(".tip").hide(),s(i(e).siblings(".account").find("input")[0]),i(e).attr("disabled",!0),0==u)return i(e).siblings(".account").find(".tip").text("您输入的不是一个手机号或邮箱").css("display","inline-table"),void i(e).attr("disabled",!1);var t=i(e).siblings(".imgcode").find("input").val();if(""==t)return i(e).siblings(".imgcode").find(".tip").text("请输入右侧的图形验证码").css("display","inline-table"),void i(e).attr("disabled",!1);if(1==u){var n={};n.module="Auth.Login",n.action="CheckIsEmailReg",n.account=f,i.ajax({data:n}).done(function(n){if(n.Success)if("1"==n.Data){var s={};s.module="Auth.ForgetPwd",s.action="SendResetPwdEmail",s.email=f,s.imgverifycode=t,i.ajax({data:s}).done(function(t){if(i(e).attr("disabled",!1),t.Success)d(1,f);else switch(t.ErrorData){case"imgverifycode":i(e).siblings(".imgcode").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;case"email":i(e).siblings(".account").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;default:alert(t.ErrorMsg)}})}else i(e).siblings(".account").find(".tip").text("这个邮箱还没有注册").css("display","inline-table")})}if(2==u){var n={};n.module="Auth.Login",n.action="CheckIsMobileReg",n.account=f,i.ajax({data:n}).done(function(n){if(n.Success&&!n.HasError){if("1"==n.Data){var s={};s.module="Common.VerifyCode",s.action="CheckImgCode",s.captchacode=t,i.ajax({data:s}).done(function(t){i(e).attr("disabled",!1),t.Success&&!t.HasError?l():i(e).siblings(".imgcode").find(".tip").text(t.ErrorMsg).css("display","inline-table")})}else i(e).siblings(".account").find(".tip").html("这个帐号还未注册").css({display:"block"}),i(e).attr("disabled",!1)}else i(e).attr("disabled",!1),n.HasError&&n.ErrorMsg&&alert(n.ErrorMsg)})}}),i(".forgotpw_phone .prev").click(function(){c()}),i(".forgotpw_phone .submit").click(function(){var e=this;if(i(e).attr("disabled",!0),i(".tip").hide(),2!=u)return alert("帐号错误，请返回上一步，重新输入"),void i(e).attr("disabled",!1);var t=i(".pwd1 input").val();if(""!=t&&t!=i(".pwd2 input").val())return i(".pwd2 .tip").text("两次密码不相同").css("display","inline-table"),void i(e).attr("disabled",!1);if(t.length<6||t.length>16)return i(".pwd1 .tip").text("密码为6-16位").css("display","inline-table"),void i(e).attr("disabled",!1);var n=i(".forgotpw .imgcode").find("input").val();if(""==n)return alert("图形验证码不能为空，请返回上一步，重新输入"),void i(e).attr("disabled",!1);if(2==u&&""==(n=i(e).siblings(".phonecode").find("input").val()))return i(e).siblings(".phonecode").find(".tip").text("请输入短信验证码").css("display","inline-table"),void i(e).attr("disabled",!1);var s={};s.module="Auth.ForgetPwd",s.action="SmsResetPwd",s.phone=f,s.verifycode=n,s.pwd=t,i.ajax({data:s}).done(function(t){if(i(e).attr("disabled",!1),t.Success)d(2);else if(t.HasError)switch(t.ErrorData){case"pwd":i(e).siblings(".password").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;case"phone":i(".prev").click(),i(".forgotpw .account").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;case"verifycode":i(e).siblings(".phonecode").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;default:alert(t.ErrorMsg)}})});var b=0,h=null;i(".code_sms").on("click",function(){function e(){var e={};e.module="Common.VerifyCode",e.action="SendVerifyCode",e.mobile=f,e.captchacode=n,e.verifytype=1,e.sceneType=1,i.ajax({data:e}).done(function(e){if(i(t).attr("disabled",!1),e.Success&&!e.HasError)b=60,h=setInterval(function(){i(".code_sms").text(b+"秒后重新获取").css("background-color","#ccc"),--b<=0&&(clearInterval(h),i(t).parent().find("div").show(),i(".code_sms").text("获取短信验证码").css("background-color","#000"))},1e3);else{if(e.HasError&&e.ErrorMsg)switch(e.ErrorData){case"mobile":i(t).parent().siblings(".account").find(".tip").text(e.ErrorMsg).css("display","inline-table");break;case"captchacode":i(t).parent().siblings(".imgcode").find(".tip").text(e.ErrorMsg).css("display","inline-table");break;default:alert(e.ErrorMsg)}i(t).parent().siblings(".imgcode").find("img").click()}})}if(0==b){var t=this;if(i(t).attr("disabled",!0),i(t).parent().siblings(".account").find(".tip").hide(),i(t).parent().siblings(".imgcode").find(".tip").hide(),2!=u)return i(t).parent().siblings(".account").find(".tip").text("请输入手效的手机号").css("display","inline-table"),void i(t).attr("disabled",!1);var n=i(t).parent().siblings(".imgcode").find("input").val();if(""==n)return i(t).parent().siblings(".imgcode").find(".tip").text("请输入右侧的图形验证码").css("display","inline-table"),void i(t).attr("disabled",!1);if(i(t).parents("section").hasClass("register_phone_dialog")){var s={};s.module="Auth.Login",s.action="CheckIsMobileReg",s.account=f,i.ajax({data:s}).done(function(n){if(i(t).attr("disabled",!1),n.Success&&!n.HasError){"0"==n.Data?e():i(t).parent().siblings(".account").find(".tip").html("这个帐号已经注册过了，请直接登录").css({display:"block"})}else n.HasError&&n.ErrorMsg&&alert(n.ErrorMsg)})}else e()}}),i(".page_login .code_phone").on("click",function(){if(0==b){var e=this;if(i(e).attr("disabled",!0),i(e).parent().hide(),i(e).parent().parent().siblings(".account").find(".tip").hide(),i(e).parent().parent().siblings(".imgcode").find(".tip").hide(),2!=u)return i(e).parent().parent().siblings(".account").find(".tip").text("请输入手效的手机号").css("display","inline-table"),void i(e).attr("disabled",!1);var t=i(e).parent().parent().siblings(".imgcode").find("input").val();if(""==t)return i(e).parent().parent().siblings(".imgcode").find(".tip").text("请输入右侧的图形验证码").css("display","inline-table"),void i(e).attr("disabled",!1);var n={};n.module="Common.VerifyCode",n.action="SendVerifyCode",n.mobile=f,n.captchacode=t,n.verifytype=2,n.sceneType=1,i.ajax({data:n}).done(function(t){if(i(e).attr("disabled",!1),t.Success&&!t.HasError)b=60,h=setInterval(function(){i(".code_sms").text(b+"秒后重新获取").css("background-color","#ccc"),--b<=0&&(clearInterval(h),i(e).parent().show(),i(".code_sms").text("获取短信验证码").css("background-color","#000"))},1e3);else{if(t.HasError&&t.ErrorMsg)switch(t.ErrorData){case"mobile":i(e).parent().parent().siblings(".account").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;case"captchacode":i(e).parent().parent().siblings(".imgcode").find(".tip").text(t.ErrorMsg).css("display","inline-table");break;default:alert(t.ErrorMsg)}i(e).parent().parent().siblings(".imgcode").find("img").click()}})}}),i(".password input").keydown(function(){13==event.keyCode&&(event.cancelBubble=!0,event.returnValue=!1,i(this).parent().siblings(".submit").click())}),i(".forgotpw .imgcode input").keydown(function(){13==event.keyCode&&(event.cancelBubble=!0,event.returnValue=!1,i(this).parent().siblings(".submit").click())}),i(".forgotpw_phone .phonecode input").keydown(function(){13==event.keyCode&&(event.cancelBubble=!0,event.returnValue=!1,i(this).parent().siblings(".submit").click())}),i(".codeimg_login").on("click",function(){i(this).attr("src","/SessionWriteable/GetLoginCaptcha?t="+new Date)}),window.fbAsyncInit=function(){FB.init({appId:"122870828257667",cookie:!0,xfbml:!0,version:"v2.8"}),FB.AppEvents.logPageView();var e=function(e){var t={module:"Auth.Login",action:"FacebookLogin",userToken:JSON.stringify(e)};FB.api("/me",{fields:"picture,name,gender"},function(e){e.picture&&e.picture.data.url&&(e.picture=e.picture.data.url),t.userInfo=JSON.stringify(e),i.ajax("/sessionwriteable/FacebookLogin",{data:t}).done(function(i){i.IsOk?loginpass():i.ErrorMsg&&alert(i.ErrorMsg)})})};window.FBLogin=function(){FB.getLoginStatus(function(i){i.authResponse?e(i):FB.login(e)})}},function(i,e,t){var n,s=i.getElementsByTagName(e)[0];i.getElementById(t)||(n=i.createElement(e),n.id=t,n.src="//connect.facebook.net/en_US/sdk.js",n.async=!0,s.parentNode.insertBefore(n,s))}(document,"script","facebook-jssdk")});
//# sourceMappingURL=../../map/script/page/Auth.Login.min.js.map
